<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fennix Project: kernel/drivers/storage/floppy.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Fennix Project
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">Opeating System from scratch made in C and C++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d7/d9e/floppy_8cpp_source.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">floppy.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d7/d9e/floppy_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d62/floppy_8h.html">floppy.h</a>&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &quot;../../cpu/idt.h&quot;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;interrupts.h&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../dc/dac/io_8h.html">io.h</a>&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../de/d21/asm_8h.html">asm.h</a>&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160; </div>
<div class="line"><a name="l00007"></a><span class="lineno"><a class="line" href="../../d7/d9e/floppy_8cpp.html#aefa88d4dbc9204939bccb9dcb2a41696">    7</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d9e/floppy_8cpp.html#aefa88d4dbc9204939bccb9dcb2a41696">ReceivedIRQ</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160; </div>
<div class="line"><a name="l00009"></a><span class="lineno"><a class="line" href="../../d6/d87/namespaceFloppy.html">    9</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="../../d6/d87/namespaceFloppy.html">Floppy</a></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;{</div>
<div class="line"><a name="l00011"></a><span class="lineno"><a class="line" href="../../d7/d9e/floppy_8cpp.html#aab515240cf2dca31fd879ba13c79eb67">   11</a></span>&#160;<span class="preprocessor">#define DOR 0x3F2</span></div>
<div class="line"><a name="l00012"></a><span class="lineno"><a class="line" href="../../d7/d9e/floppy_8cpp.html#ad4bf7893b2451e38ffd105d563b0a18d">   12</a></span>&#160;<span class="preprocessor">#define CCR 0x3F7</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160; </div>
<div class="line"><a name="l00014"></a><span class="lineno"><a class="line" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a7e6bc10fe80897cbb0af5278036a385d">   14</a></span>&#160;    <span class="keywordtype">string</span> <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a7e6bc10fe80897cbb0af5278036a385d">FloppyDriver::ReturnFloppyType</a>(<span class="keywordtype">int</span> i)</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    {</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;        <span class="keywordflow">switch</span> (i)</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        {</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;No floppy drive.&quot;</span>;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;360KB 5.25in floppy&quot;</span>;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;1.2MB 5.25in floppy&quot;</span>;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;720KB 3.5in floppy&quot;</span>;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <span class="keywordflow">case</span> 4:</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;1.44MB 3.5in floppy&quot;</span>;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="keywordflow">case</span> 5:</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;2.88MB 3.5in floppy&quot;</span>;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;error&quot;</span>;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        }</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    }</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#aeeb12b39ac3386b715f4323c87865dd0">   42</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#aeeb12b39ac3386b715f4323c87865dd0">FloppyDriver::SendByte_FDC</a>(<span class="keywordtype">char</span> b)</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> a = 0;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;            <span class="comment">// usleep(100);</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            a = <a class="code" href="../../dc/dac/io_8h.html#a391e9b8bf10e07c26f6db68c10d008cf">inb</a>(0x3F4);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;            a &amp;= 0x80;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            <span class="keywordflow">if</span> (a == 0x80)</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        }</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="comment">// usleep(100);</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <a class="code" href="../../dc/dac/io_8h.html#a3529f17f415c111e731ea02f24f115ba">outb</a>(0x3F5, b);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    }</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a6e1c829cd85b2a2f9dafe34a0fe34fbd">   57</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a6e1c829cd85b2a2f9dafe34a0fe34fbd">FloppyDriver::RecByte_FDC</a>()</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> a;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> b;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            <span class="comment">// usleep(100);</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            a = <a class="code" href="../../dc/dac/io_8h.html#a391e9b8bf10e07c26f6db68c10d008cf">inb</a>(0x3F4);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            a &amp;= 0x80;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <span class="keywordflow">if</span> (a == 0x80)</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        }</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        b = <a class="code" href="../../dc/dac/io_8h.html#a391e9b8bf10e07c26f6db68c10d008cf">inb</a>(0x3F5);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keywordflow">return</span> b;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a8361675f46ac268c69a7ce70de453a27">   73</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a8361675f46ac268c69a7ce70de453a27">FloppyDriver::Recal</a>()</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> res = 0;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cres = 0;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#aeeb12b39ac3386b715f4323c87865dd0">SendByte_FDC</a>(7);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#aeeb12b39ac3386b715f4323c87865dd0">SendByte_FDC</a>(0);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#aeeb12b39ac3386b715f4323c87865dd0">SendByte_FDC</a>(0x08);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            res = <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a6e1c829cd85b2a2f9dafe34a0fe34fbd">RecByte_FDC</a>();</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            cres = res &amp; 0x80;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="keywordflow">if</span> (cres == 0x80)</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            res = <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a6e1c829cd85b2a2f9dafe34a0fe34fbd">RecByte_FDC</a>();</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <span class="keywordflow">if</span> (res == 0)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a71ee7a786130aeb6b86a8bc88c1eb349">   92</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a71ee7a786130aeb6b86a8bc88c1eb349">FloppyDriver::SeekTrackSide</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> track, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> side)</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> a, b, c;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#aeeb12b39ac3386b715f4323c87865dd0">SendByte_FDC</a>(0x0F);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#aeeb12b39ac3386b715f4323c87865dd0">SendByte_FDC</a>(side * 4);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#aeeb12b39ac3386b715f4323c87865dd0">SendByte_FDC</a>(track);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#aeeb12b39ac3386b715f4323c87865dd0">SendByte_FDC</a>(0x08);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            a = <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a6e1c829cd85b2a2f9dafe34a0fe34fbd">RecByte_FDC</a>();</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            a &amp;= 0x80;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <span class="keywordflow">if</span> (a != 0x80)</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            a = <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a6e1c829cd85b2a2f9dafe34a0fe34fbd">RecByte_FDC</a>();</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="keywordflow">if</span> (a == track)</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a3d96532ec2d0a93bf7e5193d72dbae5d">  111</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a3d96532ec2d0a93bf7e5193d72dbae5d">FloppyDriver::MotorOn</a>() { <a class="code" href="../../dc/dac/io_8h.html#a3529f17f415c111e731ea02f24f115ba">outb</a>(<a class="code" href="../../d7/d9e/floppy_8cpp.html#aab515240cf2dca31fd879ba13c79eb67">DOR</a>, 0x1C); }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#ab17998f19651104faaac96556e9e87e4">  113</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#ab17998f19651104faaac96556e9e87e4">FloppyDriver::MotorOff</a>() { <a class="code" href="../../dc/dac/io_8h.html#a3529f17f415c111e731ea02f24f115ba">outb</a>(<a class="code" href="../../d7/d9e/floppy_8cpp.html#aab515240cf2dca31fd879ba13c79eb67">DOR</a>, 0x0); }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a717792e8d22ecc2ca186de879746e4a7">  115</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a717792e8d22ecc2ca186de879746e4a7">FloppyDriver::WaitForIRQ</a>()</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <a class="code" href="../../d7/d9e/floppy_8cpp.html#aefa88d4dbc9204939bccb9dcb2a41696">ReceivedIRQ</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="../../d7/d9e/floppy_8cpp.html#aefa88d4dbc9204939bccb9dcb2a41696">ReceivedIRQ</a> == <span class="keyword">false</span>)</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <a class="code" href="../../de/d21/asm_8h.html#a009cd3609b6bfa1f46659cce834ce5fc">HLT</a>;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a2c7aaec3c546103f7bf56d17ffda2a9c">  122</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a2c7aaec3c546103f7bf56d17ffda2a9c">FloppyDriver::ResetFloppy</a>()</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="comment">// TODO: as the osdev wiki said &quot;Sure this code looks OK, but some emulators or floppy drives might manage to be faster than your code. What if you&#39;ve just returned from EnableController() and the floppy already issued the IRQ6? Then ReceivedIRQ will be set to true, your driver will enter WaitForIRQ(), set it to false again and then infinitely loop, waiting for an IRQ that has already been received.&quot;</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <a class="code" href="../../dc/dac/io_8h.html#a3529f17f415c111e731ea02f24f115ba">outb</a>(<a class="code" href="../../d7/d9e/floppy_8cpp.html#aab515240cf2dca31fd879ba13c79eb67">DOR</a>, 0x00);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <a class="code" href="../../dc/dac/io_8h.html#a3529f17f415c111e731ea02f24f115ba">outb</a>(<a class="code" href="../../d7/d9e/floppy_8cpp.html#aab515240cf2dca31fd879ba13c79eb67">DOR</a>, 0x0C);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <a class="code" href="../../dc/dac/io_8h.html#a3529f17f415c111e731ea02f24f115ba">outb</a>(<a class="code" href="../../d7/d9e/floppy_8cpp.html#ad4bf7893b2451e38ffd105d563b0a18d">CCR</a>, 0x00);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a717792e8d22ecc2ca186de879746e4a7">WaitForIRQ</a>();</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="../../d6/d87/namespaceFloppy.html#aa657497572fb9a9d41939faa0af8f884">  131</a></span>&#160;    <a class="code" href="../../d6/d87/namespaceFloppy.html#aa657497572fb9a9d41939faa0af8f884">InterruptHandler</a>(FloppyDriveHandler)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <a class="code" href="../../d7/d9e/floppy_8cpp.html#aefa88d4dbc9204939bccb9dcb2a41696">ReceivedIRQ</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        (void)(regs);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    }</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a21e12e0adaef7290230aa2c81b7583f6">  137</a></span>&#160;    <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a21e12e0adaef7290230aa2c81b7583f6">FloppyDriver::FloppyDriver</a>()</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <a class="code" href="../../d3/d7e/int_8h.html#a82ff29be9b9e427e81dac56660d946c8">RegisterInterrupt</a>(FloppyDriveHandler, IRQ6, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <a class="code" href="../../dc/dac/io_8h.html#a3529f17f415c111e731ea02f24f115ba">outb</a>(0x70, 0x10);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        c = <a class="code" href="../../dc/dac/io_8h.html#a391e9b8bf10e07c26f6db68c10d008cf">inb</a>(0x71);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <a class="code" href="../../db/d16/debug_8h.html#a87de2fca12ef8f7205584b972c8b1f16">trace</a>(<span class="stringliteral">&quot;1: %s&quot;</span>, <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a7e6bc10fe80897cbb0af5278036a385d">ReturnFloppyType</a>(c &gt;&gt; 4));</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <a class="code" href="../../db/d16/debug_8h.html#a87de2fca12ef8f7205584b972c8b1f16">trace</a>(<span class="stringliteral">&quot;2: %s&quot;</span>, <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a7e6bc10fe80897cbb0af5278036a385d">ReturnFloppyType</a>(c &amp; 0xF));</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordflow">if</span> ((c &gt;&gt; 4) != 0)</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            this-&gt;<a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#aaf9b4cc43f88286becc200527dd9599a">Drives</a>[0].<a class="code" href="../../dd/d67/structFloppy_1_1FloppyDrive.html#a27b40b3d4b81cd526500ead61ef38493">Name</a> = <span class="stringliteral">&quot;fd0&quot;</span>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordflow">if</span> ((c &amp; 0xF) != 0)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            this-&gt;<a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#aaf9b4cc43f88286becc200527dd9599a">Drives</a>[1].<a class="code" href="../../dd/d67/structFloppy_1_1FloppyDrive.html#a27b40b3d4b81cd526500ead61ef38493">Name</a> = <span class="stringliteral">&quot;fd1&quot;</span>;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="comment">// TODO: implement read/writing to floppy</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a9390e5faff32fed67ae219f0661dd904">  154</a></span>&#160;    <a class="code" href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a9390e5faff32fed67ae219f0661dd904">FloppyDriver::~FloppyDriver</a>()</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <a class="code" href="../../db/d16/debug_8h.html#a188ea7036db9c1d3fc1062750f3cab77">warn</a>(<span class="stringliteral">&quot;Tried to uninitialize Floppy driver!&quot;</span>);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aio_8h_html_a391e9b8bf10e07c26f6db68c10d008cf"><div class="ttname"><a href="../../dc/dac/io_8h.html#a391e9b8bf10e07c26f6db68c10d008cf">inb</a></div><div class="ttdeci">#define inb(Port)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dac/io_8h_source.html#l00209">io.h:209</a></div></div>
<div class="ttc" id="aclassFloppy_1_1FloppyDriver_html_a6e1c829cd85b2a2f9dafe34a0fe34fbd"><div class="ttname"><a href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a6e1c829cd85b2a2f9dafe34a0fe34fbd">Floppy::FloppyDriver::RecByte_FDC</a></div><div class="ttdeci">unsigned char RecByte_FDC()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00057">floppy.cpp:57</a></div></div>
<div class="ttc" id="aclassFloppy_1_1FloppyDriver_html_ab17998f19651104faaac96556e9e87e4"><div class="ttname"><a href="../../d1/dad/classFloppy_1_1FloppyDriver.html#ab17998f19651104faaac96556e9e87e4">Floppy::FloppyDriver::MotorOff</a></div><div class="ttdeci">void MotorOff()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00113">floppy.cpp:113</a></div></div>
<div class="ttc" id="aclassFloppy_1_1FloppyDriver_html_aeeb12b39ac3386b715f4323c87865dd0"><div class="ttname"><a href="../../d1/dad/classFloppy_1_1FloppyDriver.html#aeeb12b39ac3386b715f4323c87865dd0">Floppy::FloppyDriver::SendByte_FDC</a></div><div class="ttdeci">void SendByte_FDC(char b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00042">floppy.cpp:42</a></div></div>
<div class="ttc" id="afloppy_8cpp_html_aab515240cf2dca31fd879ba13c79eb67"><div class="ttname"><a href="../../d7/d9e/floppy_8cpp.html#aab515240cf2dca31fd879ba13c79eb67">DOR</a></div><div class="ttdeci">#define DOR</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00011">floppy.cpp:11</a></div></div>
<div class="ttc" id="aclassFloppy_1_1FloppyDriver_html_a8361675f46ac268c69a7ce70de453a27"><div class="ttname"><a href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a8361675f46ac268c69a7ce70de453a27">Floppy::FloppyDriver::Recal</a></div><div class="ttdeci">void Recal()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00073">floppy.cpp:73</a></div></div>
<div class="ttc" id="adebug_8h_html_a87de2fca12ef8f7205584b972c8b1f16"><div class="ttname"><a href="../../db/d16/debug_8h.html#a87de2fca12ef8f7205584b972c8b1f16">trace</a></div><div class="ttdeci">#define trace(m,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00066">debug.h:66</a></div></div>
<div class="ttc" id="aclassFloppy_1_1FloppyDriver_html_a7e6bc10fe80897cbb0af5278036a385d"><div class="ttname"><a href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a7e6bc10fe80897cbb0af5278036a385d">Floppy::FloppyDriver::ReturnFloppyType</a></div><div class="ttdeci">string ReturnFloppyType(int i)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00014">floppy.cpp:14</a></div></div>
<div class="ttc" id="anamespaceFloppy_html_aa657497572fb9a9d41939faa0af8f884"><div class="ttname"><a href="../../d6/d87/namespaceFloppy.html#aa657497572fb9a9d41939faa0af8f884">Floppy::InterruptHandler</a></div><div class="ttdeci">InterruptHandler(FloppyDriveHandler)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00131">floppy.cpp:131</a></div></div>
<div class="ttc" id="aclassFloppy_1_1FloppyDriver_html_a21e12e0adaef7290230aa2c81b7583f6"><div class="ttname"><a href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a21e12e0adaef7290230aa2c81b7583f6">Floppy::FloppyDriver::FloppyDriver</a></div><div class="ttdeci">FloppyDriver()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00137">floppy.cpp:137</a></div></div>
<div class="ttc" id="aclassFloppy_1_1FloppyDriver_html_aaf9b4cc43f88286becc200527dd9599a"><div class="ttname"><a href="../../d1/dad/classFloppy_1_1FloppyDriver.html#aaf9b4cc43f88286becc200527dd9599a">Floppy::FloppyDriver::Drives</a></div><div class="ttdeci">FloppyDrive Drives[2]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d62/floppy_8h_source.html#l00070">floppy.h:70</a></div></div>
<div class="ttc" id="afloppy_8h_html"><div class="ttname"><a href="../../d7/d62/floppy_8h.html">floppy.h</a></div></div>
<div class="ttc" id="astructFloppy_1_1FloppyDrive_html_a27b40b3d4b81cd526500ead61ef38493"><div class="ttname"><a href="../../dd/d67/structFloppy_1_1FloppyDrive.html#a27b40b3d4b81cd526500ead61ef38493">Floppy::FloppyDrive::Name</a></div><div class="ttdeci">string Name</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d62/floppy_8h_source.html#l00050">floppy.h:50</a></div></div>
<div class="ttc" id="aasm_8h_html"><div class="ttname"><a href="../../de/d21/asm_8h.html">asm.h</a></div></div>
<div class="ttc" id="aint_8h_html_a82ff29be9b9e427e81dac56660d946c8"><div class="ttname"><a href="../../d3/d7e/int_8h.html#a82ff29be9b9e427e81dac56660d946c8">RegisterInterrupt</a></div><div class="ttdeci">InterruptVector RegisterInterrupt(INTERRUPT_HANDLER Handler)</div><div class="ttdoc">Register interrupt to an interrupt handler.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dae/Interrputs_8cpp_source.html#l00093">Interrputs.cpp:93</a></div></div>
<div class="ttc" id="aclassFloppy_1_1FloppyDriver_html_a2c7aaec3c546103f7bf56d17ffda2a9c"><div class="ttname"><a href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a2c7aaec3c546103f7bf56d17ffda2a9c">Floppy::FloppyDriver::ResetFloppy</a></div><div class="ttdeci">void ResetFloppy()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00122">floppy.cpp:122</a></div></div>
<div class="ttc" id="anamespaceFloppy_html"><div class="ttname"><a href="../../d6/d87/namespaceFloppy.html">Floppy</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00009">floppy.cpp:9</a></div></div>
<div class="ttc" id="aclassFloppy_1_1FloppyDriver_html_a3d96532ec2d0a93bf7e5193d72dbae5d"><div class="ttname"><a href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a3d96532ec2d0a93bf7e5193d72dbae5d">Floppy::FloppyDriver::MotorOn</a></div><div class="ttdeci">void MotorOn()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00111">floppy.cpp:111</a></div></div>
<div class="ttc" id="afloppy_8cpp_html_aefa88d4dbc9204939bccb9dcb2a41696"><div class="ttname"><a href="../../d7/d9e/floppy_8cpp.html#aefa88d4dbc9204939bccb9dcb2a41696">ReceivedIRQ</a></div><div class="ttdeci">int ReceivedIRQ</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00007">floppy.cpp:7</a></div></div>
<div class="ttc" id="aio_8h_html_a3529f17f415c111e731ea02f24f115ba"><div class="ttname"><a href="../../dc/dac/io_8h.html#a3529f17f415c111e731ea02f24f115ba">outb</a></div><div class="ttdeci">#define outb(Port, Data)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dac/io_8h_source.html#l00212">io.h:212</a></div></div>
<div class="ttc" id="afloppy_8cpp_html_ad4bf7893b2451e38ffd105d563b0a18d"><div class="ttname"><a href="../../d7/d9e/floppy_8cpp.html#ad4bf7893b2451e38ffd105d563b0a18d">CCR</a></div><div class="ttdeci">#define CCR</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00012">floppy.cpp:12</a></div></div>
<div class="ttc" id="aclassFloppy_1_1FloppyDriver_html_a9390e5faff32fed67ae219f0661dd904"><div class="ttname"><a href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a9390e5faff32fed67ae219f0661dd904">Floppy::FloppyDriver::~FloppyDriver</a></div><div class="ttdeci">~FloppyDriver()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00154">floppy.cpp:154</a></div></div>
<div class="ttc" id="aclassFloppy_1_1FloppyDriver_html_a71ee7a786130aeb6b86a8bc88c1eb349"><div class="ttname"><a href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a71ee7a786130aeb6b86a8bc88c1eb349">Floppy::FloppyDriver::SeekTrackSide</a></div><div class="ttdeci">void SeekTrackSide(unsigned char track, unsigned char side)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00092">floppy.cpp:92</a></div></div>
<div class="ttc" id="adebug_8h_html_a188ea7036db9c1d3fc1062750f3cab77"><div class="ttname"><a href="../../db/d16/debug_8h.html#a188ea7036db9c1d3fc1062750f3cab77">warn</a></div><div class="ttdeci">#define warn(m,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d16/debug_8h_source.html#l00067">debug.h:67</a></div></div>
<div class="ttc" id="aio_8h_html"><div class="ttname"><a href="../../dc/dac/io_8h.html">io.h</a></div></div>
<div class="ttc" id="aasm_8h_html_a009cd3609b6bfa1f46659cce834ce5fc"><div class="ttname"><a href="../../de/d21/asm_8h.html#a009cd3609b6bfa1f46659cce834ce5fc">HLT</a></div><div class="ttdeci">#define HLT</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d21/asm_8h_source.html#l00113">asm.h:113</a></div></div>
<div class="ttc" id="aclassFloppy_1_1FloppyDriver_html_a717792e8d22ecc2ca186de879746e4a7"><div class="ttname"><a href="../../d1/dad/classFloppy_1_1FloppyDriver.html#a717792e8d22ecc2ca186de879746e4a7">Floppy::FloppyDriver::WaitForIRQ</a></div><div class="ttdeci">void WaitForIRQ()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d9e/floppy_8cpp_source.html#l00115">floppy.cpp:115</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_dc43877d82dd332f9fb2071fcca799d6.html">kernel</a></li><li class="navelem"><a class="el" href="../../dir_0de1d64efa6df97eacc8f5b0f9da3e59.html">drivers</a></li><li class="navelem"><a class="el" href="../../dir_a134a2fb5e172a94925fa8b74d28947c.html">storage</a></li><li class="navelem"><a class="el" href="../../d7/d9e/floppy_8cpp.html">floppy.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
